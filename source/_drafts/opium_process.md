---
title: 鍊金術贗勢說明
date: 2017-10-21 12:16:47
tags: [ CASTEP , Linux , M.S. , Pseudopotential , Alchemy , Opium ]
categories: Opium
password: alchemist
photos:
- "https://images.unsplash.com/photo-1477519726670-15a7b643a08c?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=9d998e5c3239b9ba8ba1c6b02a137afd&auto=format&fit=crop&w=1950&q=80"
---
>*以下內文教學均為 ZwHuang 研究生所指導*
*撰寫:Chieh Tsai*	                            									
*時間:2017/09/19*
*※這是ZwHuang研究生碩士論文 之後會放上清楚來源*

# [Keyword]
離子實
# [產生贗勢目的]
讓波函數的(曲線)平滑 ►► 也就是「贗勢」 (真實的曲線應該是上下起伏，有所震盪)
# [簡易流程理念]

	1. 由薛丁格方程式中，求解全電子的各種解(包含波函數、本徵值...etc)
	2. 贗化波函數 ► 讓震盪波函數變成平滑的波函數 (俗稱:混血波函數)，把真實的波函數而我們取出虛線的波函數，這動作為贗化波函數
	3. 怎樣的一個贗勢，可以使用贗化波函數得到全電子的本徵值? (We should find.)

<!--more-->

------------------------------------------------------------------------------
# [執行指令]
##   ．指令:
```
	(opium執行檔位置) (atom_name).param (atom_name).log all rpt recpot plot ke plot wp plot logd plot vi
```
##   ．介紹:
```
	param     ►► 檔案自行準備，包含內容需自建 (底下有詳細說明)
	log       ►► 所有的行為，包含error都會寫入於此
	all       ►► 全部都會計算，包含ae(原子的全部電子解)、ps(產生贗勢)、nl、tc(test configurations組態測試)
	rpt       ►► 寫出report檔，會報告全電子和贗化後的(各個軌域)本徵值差
	plot ke   ►► 畫出動能的圖
	plot wp   ►► 波函數的圖，用實線表示全電子波函數，虛線表示贗化波函數
	plot logd ►► 相位圖的測試 (波函數一次微分/波函數)=微分log波函數   (若有相對論效應，則無法看到logd)
	             我們利用觀看logd圖判斷相位留下來的相，判斷相位若相符，表示波函數的散射行為則是相同的，
							 波函數往後的行為，以動力學來說也會是一樣的
	plot vi   ►► 未去價電子影響的位勢，可以幫助判斷是否連續，或者波函數是否為震盪?(平滑?)
	             因若切掉(價電子)後，行為依舊會延續未切掉，以此做確認是否有異。
```

##   ．詳細參考網址:
[Opium-pseudopotential generation project](http://opium.sourceforge.net/guide.html)

------------------------------------------------------------------------------
# [自建 .param 檔內容/格式解釋]
※以下為例子
```
  [Atom]
	Au           (atom name)
	15           (有幾個軌域)
	100 2.00 -  ╕
	200 2.00 -  │
	210 6.00 -  │
	300 2.00 -  │				最左邊(ex.100)為 nlm(主量子數，角量子數，磁量子數)
	310 6.00 -  │				中間  (ex.2.00)為 電子佔據數(1S2 2S2 2P6...etc)
	400 2.00 -  │				最右邊(ex. - )為 本徵值數(若有數據就可填入，沒有就為Default)
	410 6.00 -  │
	320 10.00 - ├(電子組態)
	500 2.00 -  │        
	510 6.00 -  │        
	420 10.00 - │                  
	430 14.00 - │
	600 0.00 -  │
	610 0.00 -  │
	520 10.00 - ╛

  [Pseudo]
  3	     (要算3個軌域之意，又外層往內算起，ex.600 610 520這三組)
  2.0 3.0 2.0  (若算3個軌域則填入三個軌域的半徑，單位是波爾半徑，此即為rc參數。)
		     (最左邊為最內層，不同軌域的角動量不同，因此半徑也可能會不相同，需做測試。)
	opt	   (表示是利用opt的方法計算贗勢，總共有三種 optimized, kerker, tm)

  [Optinif]
	7.0 5      (7.0即為截止動能，789就已經算很高的值，即為qc參數-->影響ke值。)
	3.0 5	     (5為使用5個Bessel方程來做疊加，一般為4倍)
	7.0 5

  [Configs]
  3            (計算三個軌域則輸入3，下方就做3種軌域不同的變化計畫)
  #            (改變電子數做計算測試)
	600 1.00 -   Q:如果這裡600是1.0，520應該為9.0才對?
	610 0.00 -   A:是對的，多或少電子只是變成正負價的原子，
	520 10.00 -           藉由這樣調控去調配到正確的贗勢為技巧之一。
  #
	600 1.00 -
	610 0.00 -
	520 9.00 -
  #
	600 0.50 -
	610 0.00 -
	520 9.50 -

  [Xc]         (交互相干能)
	pbe          (代表使用PBE來做交互相干能計算)

  [Relativity]
	srl	     (要不要讓元素做相對論效應，通常是5d以上的元素才會讓他做相對論效應的選項)
		     	 (不要相對論效應則輸入 nrl)

  [Loginfo]     (有使用相對論條件時，這個就不會顯示出來，需關掉)
	0             (看的組態數目)
	2.50 -8.0 8.0 (2.5通常為中點，為rc值。-8.0與8.0為左右距離)
```
>   ．Note:
	rc qc 產生厭世主要調控的變數
   ．詳細參考網址:
	https://www.webelements.com/

------------------------------------------------------------------------------
# [獲取優良的贗勢所需條件]
	1. 很好的收斂性(看Ke圖分析)
	2. 平滑連續的波函數與位勢
	3. 有很高的可轉移性 (意即不同configuration的本徵值要相近)
	4. 看logd，其散射行為需要良好
------------------------------------------------------------------------------
# [.RECPOT檔] 很常忘記!!需要注意!! (3.7.2才需要)
	需於.RECPOT檔中自行加入CASTEP所需要讀入的資訊
	加入位置於 ►►  END COMMENT
 	(值為固定)	3 5
------------------------------------------------------------------------------
# [使用版本注意]
	Name: opium-v3.7.3 				最新版，擁有d&f軌域混合
	Name: opium-3.7.(3/4)-src 不須使用
	Name: opium-3.7.2-src     才是真正有更改過的版本
	Name: opium-3.7-src-tgz   為原官方版本
------------------------------------------------------------------------------
# [作法]
```
	需事先準備七個檔案
	1. alcwnl.txt (需自己產生)(wnl是價電子數，若要算不同的價電子數的元素需從此做更改。)
	2. Wps1_s.txt (贗化波函數 W必定要大寫)
	3. Wps1_p.txt (贗化波函數 W必定要大寫)
	4. pc.txt     (控制贗化波函數的混合比例)
	5. pcen.txt   (控制本徵值的混合比例)    
	6. en.txt     (本徵值，會由另外程式中貼過來這裡面)(為想要混合元素的本徵值)
	7. (atom).param (需自行準備，按照上述所規定的格式做設定)
```
------------------------------------------------------------------------------
# [程式操作流程]
	混合元素: A 與 B

	<共分兩階段操作>
	(第一階段，先利用Opium計算 A元素)

##	※計算第一階段時，
	  1.務必把pc.txt檔以及pcen.txt檔參數設為0，意即不混合。
	  2.需自備 A.param檔案。
	  3.需自行隨意準備一個Wps1.txt(s&p)檔以及en.txt檔來做混合，不過不必擔心，
	    因為pc.txt以及pcen.txt檔為0不混合，因此不會影響到最後的值，
			但程式設定必須要有這個檔才能執行。

		╔══╗     ╔═════════════╗            ╔═══════════╗
		║AE║ ►►  ║Pseudize波函數║ ►►►►►►►►►  ║產生Recpot ║
		╚══╝ ↘   ╚═════════════╝       ↘    ╚══════════╝
			    ↘ ╔═══════════════════╗    ↘ ╔═════════════╗   ╔═══════════════════╗
			      ║產生A元素的en.txt檔 ║      ║產生Wps2.txt檔║ ► ║自行修改為Wps1.txt檔║
			      ╚═══════════════════╝      ╚═════════════╝   ╚═══════════════════╝

	(第二階段，拿 A元素混合 B元素)

##	※計算第二階段時，
	  1.利用第一階段計算 A元素時得到的Wps1.txt檔案，以及 A元素的en.txt檔來混合
	  2.pc.txt檔以及pcen.txt檔則自行設定，看需要用多少比例去混合。
	  3.pc.txt內的比例由0到1，0為B元素100%，1為A元素100%，價若設定0.3則意為B元素有7成;A元素有3成。
	  4.自行準備B元素的.param檔
	  執行程式前，使用B元素的 .param檔 pc.txt檔 pcen.txt檔  A元素的Wps1.txt檔 en.txt檔

		╔══╗  ╔═════════════╗  ╔═════════════╗
		║AE║ ►║Pseudize波函數║ ►║產生混合Recpot║
		╚══╝  ╚═════════════╝  ╚═════════════╝
------------------------------------------------------------------------------
# [正常計算輸出結果-小註釋]
```
	eigenvalue=  -1.00194952305725		(原本初始元素的S軌域值)
	eigenvalue= -0.398598570875805		(原本初始元素的P軌域值)
	 alcen= -0.796627474917336
	 [從外部讀取的值所以初始做時，隨意拿取en值即可](混合過元素的S軌域值)

	 alcen= -0.307051842859830
	 [從外部讀取的值所以初始做時，隨意拿取en值即可](混合過元素的P軌域值)

	 pcen=  0.500000000000000		(混合比例)
	 eigenvalue=  -1.00194952305725		(原本初始元素的S軌域值)
	 eigenvalue= -0.899288498987293		(混合過元素的S軌域值)
	 eigenvalue= -0.398598570875805		(原本初始元素的P軌域值)
	 eigenvalue= -0.352825206867818		(混合過元素的P軌域值)
	 nfam0          10
	 nmax        3942
	 nfammx=           2
	 nmax=        3942
	 optsolve works
	 (到此為已經完成所有該初始元素的所有贗化過程，包含波函數、本徵值贗化)
	 alc=           1			
	 (開始進行混合贗勢)
	 integral of wf1=   1.00170192830542
	 pc=  0.500000000000000
	 pea=  0.779627363890603
	wf2=   1.00170192830545
	 2
	peb=  0.738492007371293
	    3045
	 3
	    3044
	 6
	    4376
	 integral of fr before do radin=   1.00391760067139
	 5
	 indrc=        3202
	 eigenvalue nnn= -0.899288498987293
 	tch1=   2.00000000000000
	 tch2=   1.00110534303707
	 tch3=   2.00000000000000
	 integral of wf=   1.00170192830544
	 optsolve write rnl
	 fit
	 xro
	 ai
	 gau
	 biq
 	nfam0          10
 	nmax        3925
 	nfammx=           2
 	nmax=        3925
 	nfammx=           3
 	nmax=        3925
 	nfammx=           4
 	nmax=        3925
 	nfammx=           5
	nmax=        3925
	nfammx=           6
	nmax=        3925
	nfammx=           7
	nmax=        3925
	nfammx=           8
 	nmax=        3925
 	nfammx=           9
 	nmax=        3925
 	cq
	dij
	ei
	fin
 	gin
 	optsolve works			
 	alc=           2		
 	tch1=   2.00000000000000
 	tch2=   1.00000000000000
 	tch3=   2.00000000000000
 	integral of wf=   1.00170192830544
 	rvps  -2.33907564322124      rvcoul  -1.74971649617755
 	rvps-rvcoul -0.589359147043689
 	z=   6.00000000000000      xion=  0.000000000000000E+000
 	1
 	tch4=   2.00000000000000
 	nnn=           1 wnl=   2.00000000000000
 	optsolve write rnl
 	nfam0          10
 	nmax        4078
 	nfammx=           2
 	nmax=        4078
 	nfammx=           3
 	nmax=        4078
 	optsolve works
 	alc=           1
 	integral of wf1=   1.00170192830545
 	pc=  0.500000000000000
 	pea=  0.783220311736997
 	wf2=   1.00170192830545
 	2
 	peb=  0.620303490961302
        	3032
 	3
        	3031
 	6
        	4376
 	integral of fr before do radin=   1.04312335063091
 	5
 	indrc=        3202
 	eigenvalue nnn= -0.352825206867818
 	tch1=   4.00000000000000
 	tch2=   1.02046609243529
 	tch3=   4.00000000000000
 	integral of wf=   1.00170192830545
 	optsolve write rnl
 	fit
 	xro
 	ai
 	gau
 	biq
 	nfam0          10
 	nmax        4051
 	nfammx=           2
 	nmax=        4051
 	nfammx=           3
 	nmax=        4051
 	nfammx=           4
 	nmax=        4051
 	nfammx=           5
 	nmax=        4051
 	nfammx=           6
 	nmax=        4051
 	nfammx=           7
 	nmax=        4051
 	nfammx=           8
 	nmax=        4051
 	nfammx=           9
 	nmax=        4051
 	nfammx=          10
 	nmax=        4051
 	nfammx=          11
 	nmax=        4051
 	nfammx=           2
 	nmax=        4050
 	nfammx=           3
 	nmax=        4050
 	nfammx=           4
 	nmax=        4050
 	nfammx=           5
 	nmax=        4050
 	nfammx=           6
 	nmax=        4050
 	nfammx=           7
 	nmax=        4050
 	nfammx=           8
 	nmax=        4050
 	nfammx=           9
 	nmax=        4050
 	nfammx=          10
 	nmax=        4050
 	cq
 	dij
 	ei
 	fin
 	gin
 	optsolve works
 	alc=           2
 	tch1=   4.00000000000000
	tch2=   1.00000000000000
 	tch3=   4.00000000000000
 	integral of wf=   1.00170192830545
 	rvps  -2.17983675268404      rvcoul  -1.74971649617755
 	rvps-rvcoul -0.430120256506484
 	z=   6.00000000000000      xion=  0.000000000000000E+000
 	1
 	tch4=   4.00000000000000
 	nnn=           2 wnl=   2.00000000000000
 	optsolve write rnl
 	maxim=        4078
 	zeff  0.000000000000000E+000 indrc        3202 nval           2 zv2
 	  8.00000000000000
 	ebef= -0.899288498987293      ee= -0.894418668129297
 	ebef= -0.352825206867818      ee= -0.378119304303352
 	call1
 	call2
 	eigenvalue= -0.890597123212005
 	eigenvalue= -0.374491101289932
 	eigenvalue=  -1.00194952305725
 	eigenvalue= -0.398598570875805
 	eigenvalue= -0.890597123212005
 	eigenvalue= -0.374491101289932
 	eigenvalue=  -1.88749267360413
 	eigenvalue=  -1.26372168597883
	eigenvalue=  -1.66408614364255
 	eigenvalue=  -1.09488285532366
 	eigenvalue=  -1.88106457228139
	eigenvalue=  -1.25871364170433
	eigenvalue=  -1.61142464069418
	eigenvalue=  -1.04985388311957
	eigenvalue=  -1.00194952305725
	eigenvalue= -0.398598570875805
	eigenvalue= -0.890597123212005
	eigenvalue= -0.374491101289932
```
-----------------------------------------------------------------------
2017/11/4 (更新3.7.3版)
## 改版內容
 1. 已產出可混D&F軌域
 2. 已經關掉alcwnl.txt的要求
 3. 已經改掉需要再recpot內於END COMMENT後面加上 3 5 字樣 (會自動加上)

## 操作上須注意
 1. 需要給Wps1_d.txt檔，當然第一階段完成後要自行更改Wps2_d檔。
 2. 在en.txt需要給第三行(d軌域值)
 3. 計算完第一階段時，需從計算過程中取得三行en值並複製於en.txt檔案內做第二階段
 		► (補更) 目前en.txt已經改為自動輸出

## 目前待釐清事項
 1. 拿去MS計算BS出來的 .bands 內Spin值會有好幾個，若你只算S應該只會有一個而已。
 2. 計算一個無d軌域的atom，但atom欄裡有計算d軌域，在KBdesign欄上是否需要用d? 還是說照用p or s?
 3. 目前有發現一個招數(?)，如果再前一個(實)軌域內填入較少一點的電子好像可以增加計算時的成功率，但不確定是否適用且可靠性有多少?

-----------------------------------------------------------------------
2017/11/5 補充說明
# [config] configuration test的用意說明
在產生贗勢之後，程式會拿這個贗勢以不同的組態來解薛丁格方程式，獲得不同組態的本徵值。
而這些本徵值如果與之前(.param)在atom裡寫的組態獲得的本徵值相近，表示這個贗勢的可轉移性佳。
但我們進入混合階段(第二階段)後，我們的波函數與本徵值是與混合之前不同的，
因此在測試這個針對混合之前的贗勢的組態測試，理所當然的是不準的。
► 故可以考慮關掉。
所以在合成Pseudopotential時，其實應該在產生純元素時就該注意各種測試，
包含圖表、config test(寫在.rpt)，甚至晶胞大小測試。
當兩個元素都有相當好的表現之後，我們再來進行混合。
# [atom] 解釋說明若電子給予負的意義
給予負的電子數，表示是「非束縛態」，以前認為要加入這樣的一個狀態位勢才會好，
所謂非束縛態就是位能小於電子動能，也就是說原子核無法束縛住電子。
在這種環境下描述電子分佈函數會在無限遠處存在，其波函數應該是正的而且有點像error function，並不會掉到零以下，在原子半徑附近看起來很像指數函數，是一飛沖天的那種。
而改為正的電子就表示束縛態，既然是束縛態，電子一定無法逃脫至某個距離，有就是說你一定可以在徑向上找到波函數為零的位置，相較於非束縛態則不會有波函數為零的時候。
PS 混合程式不支援非束縛態計算，混合目的要做的是原子大小漸變的虛擬原子方法，既然是大小漸變要在意的當然是束縛電子，非束縛電子不在程式設計所關心的地方，因此未支援。

---
2017/11/12 發現問題
1. 目前計算完單原子測試之後，發現CASTEP計算完輸出的本徵值只有兩個，但我們的potential是有到d軌域
2. 不確定d給0.01時，CASTEP是否會讀入0.01這參數的電子，或者已經歸為0化為整數?

---
2017/11/13 測試內容
# [測試] 產生完的recpot檔需要測試品質
首先，把recpot檔拿去MS底下的potential檔案夾內放入，再開啟MS

測試有兩個程序:  (適用於混合recpot)
1. 做單原子測試，計算bs之後，把每個recpot檔計算bs後的本徵值放到excel，看每個本徵值是否有線性變化?
2. 做晶體測試，計算Geometry Optimization(幾何結構最佳化，並使用Optimize Cell)，記住C_Si計算請用非metal，看晶包邊長是否有線性變化，以及bs圖的線性變化

測試純元素:
拿純元素測試時，與原本MS內的potential兩個比較是否特性相近。

---
推薦可參考The Rappe Group，也是很知名的一個生產potential的Group
[The Rappe Group](http://www.sas.upenn.edu/rappegroup/research/psp.html)

另外，University of Sheffield Group也做了一個Atomic orbitals 相關的網站，滿有趣的!
[Atomic orbitals](http://winter.group.shef.ac.uk/orbitron/)

---
2018/01/08
#論文口試總結:
1. Alchemist 修改 pseudo-wave-function and eigen-energy
2. Pseudopotential 本身就是要去除掉核電子，計算價電子，可以在減少做一些平面波的基底計算
3. 運算流程是:
	All Electrons 計算 ► 贗化波函數 ► 反轉薛丁格方程式 ► 去遮蔽 ► 寫入 .recpot 檔
4. 程式內修改的部分:
	1. Alchemist在Opium裡做了程式修改的部分是 固定R格點 以及 混合本徵值 E=(1-beta)E1+(beta)E2
	2. 使用的方法是 Optimize
	3. 因為opium內不能做wave function反轉S.E.，所以我們使用Sperical Bessel function
5. VCA的峰是左右共存，函數峰值是會隨比例而高低消長。但是Alchemist是只有單一峰值會隨比例的改變而往外推移，屬電荷密度線性混合。 庫倫位勢 ► rc以外。
6. VCA的優點:
	1. 合金才是VCA使用的方法 ► 可往費米面做解釋
	2. 適合模擬大的超晶包合金或半導體
7. VCA所碰到的弱勢:
	1. 無法做聲子計算
	2. 在50%時會出現誤差的最大化問題
8. Alchemist所碰到的問題:
	1. Defect問題還是存在
9. Alchemist大小漸變於C-Si應用的部分探討:
	1. 看C ► Si之間的變化
	2. 然後r ► 變大之後
	3. pi鍵弱化造成無法再維持平面結構
10. 可以多再做一些Alchemist的測試與計算:
	1. 比較 C , Si , C-Si 之間的總能、其他基本物性(ex. 楊氏係數 等等) 來加以與 VCA做比較，更能凸顯VCA的弱勢
	2. C ► Si ► Ge的三個混合應該能夠回到 Si 這樣就可以證明出大小漸變的這一個與VCA之間的差異
	3. VCA不好的部分，Alchemist是否能夠做的好?
	4. VCA好的部分，Alchemist是否能夠做到更好?
11. 反思:
	1. 為什麼說明Alchemist的波函數外推比較好? 而VCA的雙峰共存不好?
	2. Yn 與 Eref 所附有的物理意義是什麼?
		1. alpha ► 線性漸變的混合比例參數
		2. beta ► 本徵值

---
# 修改輸出en.txt檔的位置
/opium_v3_7_valence/src/pseudo/optim.F
